---
description: 비판적 코드/아키텍처 리뷰 (피드백 + 피드포워드)
argument-hint: <target> [--scope code|arch|docs|all] [--depth quick|standard|deep]
---

비판적 리뷰, 피드백, 피드포워드를 수행하는 전문 리뷰 모드를 활성화합니다.

## 리뷰 프레임워크

### 3단계 리뷰 구조

```yaml
phase_1_critical_review:
  목적: "객관적 현상태 분석"
  관점:
    - 코드 품질 (복잡도, 가독성, 유지보수성)
    - 아키텍처 패턴 (SOLID, DRY, KISS 준수)
    - 보안 취약점 (OWASP Top 10)
    - 성능 병목점 (시간/공간 복잡도)
    - 테스트 커버리지 (단위/통합/E2E)

phase_2_feedback:
  목적: "구체적 개선점 제시"
  원칙:
    - 비판은 구체적 증거와 함께
    - 문제점마다 해결 방향 제시
    - 우선순위 명시 (Critical/High/Medium/Low)
    - 코드 예시로 개선안 시연

phase_3_feedforward:
  목적: "미래 지향적 제안"
  관점:
    - 확장성 고려사항
    - 기술 부채 예방
    - 아키텍처 진화 경로
    - 팀 역량 성장 기회
    - 자동화 및 도구 활용
```

## 사용 예시

```bash
# 현재 파일/디렉토리 리뷰
/review src/components/

# 아키텍처 심층 리뷰
/review --scope arch --depth deep

# 특정 PR 리뷰
/review PR#123

# 문서 품질 리뷰
/review docs/ --scope docs

# 전체 프로젝트 리뷰
/review . --scope all --depth standard
```

## 리뷰 옵션

| 옵션 | 값 | 설명 |
|------|-----|------|
| `--scope` | `code` | 코드 품질 중심 리뷰 (기본값) |
| | `arch` | 아키텍처 및 설계 패턴 리뷰 |
| | `docs` | 문서화 품질 리뷰 |
| | `security` | 보안 취약점 중심 리뷰 |
| | `perf` | 성능 최적화 중심 리뷰 |
| | `all` | 종합 리뷰 |
| `--depth` | `quick` | 빠른 스캔 (주요 이슈만) |
| | `standard` | 표준 리뷰 (기본값) |
| | `deep` | 심층 분석 (모든 관점) |
| `--output` | `inline` | 인라인 코멘트 스타일 |
| | `report` | 구조화된 리포트 (기본값) |
| | `checklist` | 체크리스트 형식 |

## 리뷰 페르소나

이 커맨드는 다음 페르소나를 순차적으로 활성화합니다:

```yaml
personas:
  - analyzer: "현상태 객관적 분석"
  - security: "보안 취약점 탐지"
  - performance: "성능 병목점 식별"
  - architect: "아키텍처 패턴 평가"
  - refactorer: "리팩토링 기회 식별"
  - mentor: "교육적 피드포워드 제공"
```

## 출력 형식

### Critical Review Report

```markdown
# Critical Review Report

**Target**: [리뷰 대상]
**Scope**: [code|arch|docs|security|perf|all]
**Depth**: [quick|standard|deep]
**Date**: [YYYY-MM-DD]

---

## 1. Executive Summary

### Overall Score: [A-F] ([점수]/100)

| 영역 | 점수 | 상태 |
|------|------|------|
| Code Quality | 75/100 | ⚠️ Needs Improvement |
| Architecture | 85/100 | ✅ Good |
| Security | 60/100 | 🚨 Critical Issues |
| Performance | 80/100 | ✅ Good |
| Documentation | 45/100 | ❌ Poor |

### Key Findings
- [Critical] [발견사항 1]
- [High] [발견사항 2]
- [Medium] [발견사항 3]

---

## 2. Critical Review (현상태 분석)

### 2.1 Code Quality

#### Strengths
- [강점 1]
- [강점 2]

#### Issues Found

| ID | Severity | Location | Issue | Impact |
|----|----------|----------|-------|--------|
| CQ-001 | Critical | src/auth.ts:45 | SQL Injection 취약 | Data breach risk |
| CQ-002 | High | src/api.ts:120 | Error 미처리 | Service crash |
| CQ-003 | Medium | src/utils.ts:30 | 중복 코드 | Maintainability |

### 2.2 Architecture

[아키텍처 분석 상세]

### 2.3 Security

[보안 분석 상세]

### 2.4 Performance

[성능 분석 상세]

---

## 3. Feedback (구체적 개선안)

### Issue CQ-001: SQL Injection 취약

**현재 코드**:
```typescript
// ❌ 취약한 코드
const query = `SELECT * FROM users WHERE id = ${userId}`;
```

**개선안**:
```typescript
// ✅ Parameterized query
const query = `SELECT * FROM users WHERE id = ?`;
db.query(query, [userId]);
```

**우선순위**: 🔴 Critical - 즉시 수정 필요
**예상 공수**: 30분
**관련 파일**: src/auth.ts, src/db.ts

---

## 4. Feedforward (미래 지향적 제안)

### 4.1 단기 (1-2주)

| 제안 | 근거 | 기대 효과 |
|------|------|----------|
| ESLint 규칙 강화 | 코드 품질 이슈 반복 | 자동 품질 관리 |
| 단위 테스트 추가 | 커버리지 40% | 회귀 버그 방지 |

### 4.2 중기 (1-3개월)

| 제안 | 근거 | 기대 효과 |
|------|------|----------|
| 모듈 분리 | 단일 책임 원칙 위반 | 유지보수성 향상 |
| API 버전닝 | Breaking changes 위험 | 호환성 유지 |

### 4.3 장기 (3-6개월)

| 제안 | 근거 | 기대 효과 |
|------|------|----------|
| 마이크로서비스 전환 | 확장성 한계 | 독립 배포 가능 |
| CI/CD 파이프라인 강화 | 수동 배포 오류 | 자동화된 품질 게이트 |

---

## 5. Action Items

### Immediate (24시간 내)
- [ ] CQ-001: SQL Injection 수정
- [ ] CQ-002: Error handling 추가

### This Sprint
- [ ] 단위 테스트 커버리지 60% 달성
- [ ] ESLint 규칙 업데이트

### Next Sprint
- [ ] 모듈 분리 계획 수립
- [ ] API 문서화 완료

---

## 6. Learning Opportunities

이 리뷰에서 발견된 학습 기회:

1. **OWASP Top 10** - 보안 베스트 프랙티스 학습 권장
2. **Clean Code** - Robert Martin의 클린 코드 원칙 복습
3. **Testing Pyramid** - 효과적인 테스트 전략 수립

---

*Generated by /review command - Context Engineering Framework*
```

## 평가 기준

### Code Quality Metrics

| 메트릭 | 우수 | 양호 | 개선필요 | 심각 |
|--------|------|------|----------|------|
| Cyclomatic Complexity | <10 | 10-15 | 15-25 | >25 |
| Function Length | <30 lines | 30-50 | 50-100 | >100 |
| Nesting Depth | <3 | 3-4 | 4-6 | >6 |
| Test Coverage | >80% | 60-80% | 40-60% | <40% |
| Documentation | >90% | 70-90% | 50-70% | <50% |

### Security Severity Levels

| Level | 정의 | 대응 시간 |
|-------|------|----------|
| 🔴 Critical | 즉각적 익스플로잇 가능 | 24시간 내 |
| 🟠 High | 악용 가능한 취약점 | 1주 내 |
| 🟡 Medium | 조건부 취약점 | 1개월 내 |
| 🟢 Low | 최소 위험 | 다음 릴리스 |

### Architecture Health Indicators

```yaml
healthy:
  - 모듈 간 느슨한 결합
  - 명확한 책임 분리
  - 의존성 방향 일관성
  - 테스트 용이성

warning:
  - 순환 의존성 존재
  - God class/function 존재
  - 레이어 경계 침범
  - 하드코딩된 설정

critical:
  - 스파게티 코드
  - 분산 모노리스
  - 기술 부채 누적
  - 테스트 불가능 구조
```

## 통합 워크플로우

```yaml
workflow:
  1_preparation:
    - 대상 파일/디렉토리 스캔
    - 기존 테스트 실행
    - 정적 분석 도구 결과 수집

  2_analysis:
    - 코드 복잡도 측정
    - 의존성 그래프 생성
    - 패턴 매칭 (안티패턴 탐지)

  3_review:
    - 이슈 분류 및 우선순위 지정
    - 개선안 도출
    - 코드 예시 작성

  4_synthesis:
    - 피드포워드 생성
    - 액션 아이템 도출
    - 리포트 작성

  5_follow_up:
    - 체크리스트 생성
    - 후속 리뷰 일정 제안
```

## 관련 커맨드

- `/analyze` - 코드 분석 (리뷰의 입력)
- `/improve` - 개선 실행 (리뷰의 출력)
- `/test` - 테스트 실행 (리뷰 검증)
- `/document` - 문서화 (리뷰 후속)
